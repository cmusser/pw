#!/usr/bin/env python

import argparse
import getpass
import nacl.exceptions
import pw.data
import pw.file
import pw.util
import random
import re
import string

def lookup_credential(pw_data, search_term):
    name = pw.data.lookup_credential_for_edit(pw_data, search_term)
    if name in pw_data:
        result = 'removed'
        pw_data.pop(name, None)
    else:
        result = 'not found'

    print '{} {}'.format(name, result)

parser = argparse.ArgumentParser(
    description='Edit or create password.')

parser.add_argument('pw_file', help='password list')
parser.add_argument('credential_name', nargs='?', default=None,
                    help='name of credential (if not specified, command '
                    'will prompt.')
args = parser.parse_args()

try:
    path = pw.file.path(args.pw_file)
    password = getpass.getpass()
    pw_data = pw.file.load(path, password)

    if args.credential_name is None:
        pw.util.prompt_loop('rmpw', pw_data, lookup_credential)
    else:
        lookup_credential(pw_data, args.credential_name)

    pw.file.save(path, password, pw_data)

except (IOError, nacl.exceptions.CryptoError) as e:
    print e

except (KeyboardInterrupt, EOFError):
    print
