#!/usr/bin/env python

import getpass
import nacl.exceptions
from pw.core import Cli
import re
import sys

pw_data = {}
cur = None

try:
    with open(sys.argv[1] + '.txt', "r") as in_file:
        for line in in_file:
            match = re.match(
                '(name|site|username|password|extra)\s*:\s*([^\n]+)',
                line)
            if match:
                (name, value) = match.group(1, 2)
                if (name == 'name'):
                    cur = pw_data[value] = {}
                else:
                    cur[name] = value

    cli = Cli(sys.argv[1], getpass.getpass())
    cli.pw_data = pw_data
    cli.save()
    print "imported {} credentials.".format(len(pw_data))

except (IOError, nacl.exceptions.CryptoError) as e:
    print e

except IndexError:
    print "usage: {} <pw-file-suffix>".format(sys.argv[0])
